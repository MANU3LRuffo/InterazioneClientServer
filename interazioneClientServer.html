<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Interazione con il client e il server</title>
  <style>
    h1{
      color: black;
    }
    body{
      background-color: aqua;
    }
    textarea {
      width: 300px;
      height: 200px;
      margin-bottom: 10px;
    }
    input {
      width: 300px;
      margin-bottom: 10px;
      display: block;
      overflow: hidden;
    }
    #nomeUtentePassword{
      color: black;
      font-size: 25px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
    }
    input{
      text-align: center;
    }
    button{
      background-color: aqua;
      color: black;
      font-size: 22px;
    }
    #messaggioDiErrore{
      font-size: 25px;
      color: red;
    }
  </style>
  <script>
    "use strict";
    //Inizio dialogo
    let ws = new WebSocket("ws://10.1.0.52:8090/chat25/5i2");
    ws.onmessage=gestoreRicezione;
    console.log("Ã¨ iniziato il dialogo")

    function gestoreRicezione(messaggioRicevuto){
    document.getElementById("ricezione").textContent += messaggioRicevuto.data + "\n";
    
    console.log(messaggioRicevuto.data);


    if(messaggioRicevuto.data == "R|ok"){
      cambiaSchermataAccesso();
    }
    if(messaggioRicevuto.data == "R|no"){
      cambiaSchermataConnessioneFallita();
      chiudiLaConnessione();
    }
    }
    

    function invioAccesso(){
    let nomeUtenteDaInserire = document.getElementById("nomeUtente");
    let passwordDaInserire = document.getElementById("password");
    let messaggioDaInviare = "A" + "|" + document.getElementById("nomeUtente").value + 
    "|" + document.getElementById("password").value;
    ws.send(messaggioDaInviare);

    }
    function chiudiLaConnessione(){
      //document.getElementById("ricevuta").textContent="ricevuta: connessione fallita";
      console.log("non sei riuscito a entrare");
      ws.close();
      
    }
    function cambiaSchermataAccesso(){
      document.getElementById("ricezione").style.display="block";
      document.getElementById("nomeUtentePassword").style.display="none";
      document.getElementById("messaggioDaInviare").style.display="block";
    }
    function cambiaSchermataConnessioneFallita(){
      document.getElementById("ricezioneMessaggioMessaggioInviare").style.display="none";
      document.getElementById("messaggioDiErrore").style.display="block";

    }
    function invioMessaggio(){

    }
</script>
</head>
<body>
  <h1>Dialogo server-client</h1>
  <div id="nomeUtentePassword">
    <p>nome utente</p> <input id="nomeUtente" type="text">
    <p>password</p> <input id="password" type="text">
  </div>
  <div id="ricezioneMessaggioMessaggioInviare">
    <p id="messaggioDaInviare" style="display: none;">messaggioDaInviare</p>
    <textarea id="ricezione" readonly style="display: none;"></textarea><br>
  </div>
  
  <button onClick="invioAccesso()" id="invioAccesso">accedi</button>
  <button onClick="invioMessaggio()" >invia messaggio</button>
  <p id="messaggioDiErrore" style="display: none;">
    DAI SU CHE LA PROSSIMA VOLTA CHE FAI L'ACCESSO CON IL NOME/PASSWORD GIUSTA CE LA FAI</p>
</body>
</html>